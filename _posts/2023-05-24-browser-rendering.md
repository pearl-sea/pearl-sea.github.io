---
layout: post
title: 브라우저의 렌더링 과정
categories: ["study"]
---

Node.js처럼 브라우저가 아닌 환경에서도 자바스크립트를 실행할 수 있지만 대부분의 자바스크립트는 웹 브라우저 환경에서 동작한다. 브라우저의 렌더링은 렌더링 엔진이 담당하며 짧은 시간 안에 여러 과정을 거쳐 렌더링을 수행한다.

---

#### 서버에 리소스 요청

브라우저는 서버에 리소스를 받아오기 전까지 웹사이트에 아무것도 띄울 수 없다. 사용자는 브라우저 주소창에 주소를 입력하는것만으로 서버에 요청을 보내고 리소스를 받아 올 수 있다. 이때 서버로부터 받은 HTML문서는 **바이트**(이진수) 형태이다.

#### HTML 파싱

서버로부터 전송받은 바이트 데이터는 HTML 문서 내부의 `<meta charset="utf-8">`에 의해 문자열로 변환된다. HTML 태그 안에 인코딩 방식이 지정되어 있지 않을 경우 서버의 응답 헤더에 있는 문자 인코딩 방식을 사용해 바이트데이터를 변환한다. 이렇게 문자로 변환된 HTML문서는 렌더링 엔진이 **토큰**이라는 형태로 분해한다. 토큰은 HTML 문서 내에서 문법적 의미를 가지는 최소 단위이다. 브라우저는 텍스트 데이터를 토큰으로 변환하여 시작태그, 종료태그, 속성 등을 인식하여 문서의 구조를 이해할 수 있게 된다.

#### DOM 생성

토큰은 렌더링 엔진에 의해 **노드(Node)**라고 하는 객체 형태로 변환된다. 노드가 생성되면 노드는 **DOM**이라고 하는 계층적 정보를 가진 트리 구조로 연결된다. DOM은 DOM트리라고도 불리며 자바스크립트로 제어할 수 있는 추상적인 구조이다. (자바스크립트 안에 속해있거나, 자바스크립트 문법, 또는 객체가 아니다.) DOM이 생성되면 브라우저는 자바스크립트를 이용하여 DOM에 접근하여 문서의 구조를 이해하고 조작할 수 있게 된다.

#### CSSOM 생성

CSSOM은 CSS를 파싱한 결과로 HTML과 동일한 해석 과정을 거쳐 생성되는 자료구조이다.

#### Render Tree 생성

렌더링 엔진은 DOM과 CSSOM을 결합하여 렌더 트리 구조를 생성한다. 렌더트리는 화면에 표시되어야 할 모든 노드의 컨텐츠와 스타일정보를 포함하고 있다. 화면에 렌더링되는 노드들로만 구성되어있어 `meta`태그와 `display:none` 속성등은 트리에 포함하지 않는다.

#### Render Tree 배치(레이아웃)

완성된 렌더트리를 이용해 페이지에 렌더링될 모든 요소의 위치와 크기를 정확하게 계산한다.

#### Render Tree 그리기(페인팅)

브라우저의 렌더링 엔진이 렌더트리의 요소와 텍스트, 이미지를 픽셀로 그려낸다.

#### DOM 생성이 중단되는 시점

렌더링 엔진은 HTML을 한줄씩 파싱하면서 DOM을 생성하는데 HTML 내부에서 `<script>`태그를 만나면 DOM 생성을 일시 중단한다. 그리고 `<script>`안에 정의된 자바크스립트 코드를 추가로 서버에 요청한다. 서버에서 받아온 자바스크립트 파일을 실행하는 과정이 끝나야 다시 DOM 생성이 재개된다.

#### 사이트에서 HTML, CSS의 변경이 일어났을때

요소의 크기, 위치가 바뀌었다면 레이아웃(리플로우) 과정이 다시 일어나 레이아웃 수치를 다시 계산한뒤 리페인트 과정을 진행한다. 레이아웃 수치가 변하지 않는 (그림자, 텍스트 색상, 배경 이미지 등) 스타일 변경이 일어났다면 리페인트만 실행된다.
